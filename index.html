<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <title>Starphone - CatÃ¡logo Premium</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background-color: #f8fafc; 
            overflow-x: auto; 
            width: 100%; 
            -webkit-tap-highlight-color: transparent; 
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        .product-card { display: flex; flex-direction: column; height: 100%; position: relative; transition: all 0.3s ease; border-radius: 1.5rem; border: 1px solid #f1f5f9; background: white; }
        .image-container { position: relative; width: 100%; padding-top: 100%; background: #fff; border-radius: 1.5rem 1.5rem 0 0; overflow: hidden; cursor: zoom-in; }
        .image-container img { position: absolute; top: 0; left: 0; bottom: 0; right: 0; margin: auto; max-width: 90%; max-height: 90%; object-fit: contain; }
        
        .detail-tooltip { position: relative; width: 100%; }
        .detail-content { visibility: hidden; opacity: 0; position: absolute; top: 20px; left: -10px; right: -10px; background: rgba(15, 23, 42, 0.95); backdrop-filter: blur(12px); color: #fff; padding: 20px; border-radius: 1.2rem; font-size: 12px; line-height: 1.6; z-index: 1000; box-shadow: 0 20px 40px rgba(0,0,0,0.4); max-height: 350px; overflow-y: auto; border: 1px solid rgba(255,255,255,0.15); white-space: pre-line; transition: all 0.2s ease; transform: translateY(10px); pointer-events: none; }
        .detail-content.active { visibility: visible !important; opacity: 1 !important; transform: translateY(0); pointer-events: auto; }
        .product-card.top-z { z-index: 50 !important; }

        #lightbox-img { transition: transform 0.3s ease; max-width: 95%; max-height: 85vh; object-fit: contain; }
        .zoom-active { cursor: zoom-out; transform: scale(1.5); }
        .product-title { color: #dc2626; font-weight: 700; font-size: 0.9rem; cursor: pointer; }
        .glass-header { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); }

        #cart-modal { transform: translateY(100%); transition: transform 0.3s cubic-bezier(0, 0, 0.2, 1); }
        #cart-modal.active { transform: translateY(0); }
        .note-input { width: 100%; background: #fff; border: 1px solid #e2e8f0; border-radius: 0.5rem; padding: 4px 8px; font-size: 11px; color: #475569; margin-top: 6px; outline: none; }
        .qty-input-manual { width: 45px; background: transparent; text-align: center; font-weight: 800; font-size: 0.85rem; border: none; outline: none; color: #1e293b; }

        @media (max-width: 768px) {
            .product-grid { grid-template-columns: 1fr !important; gap: 0.5rem !important; }
            .product-card { flex-direction: row !important; height: auto !important; padding: 0.5rem !important; align-items: center; border-radius: 1rem !important; }
            .image-container { width: 24vw !important; height: 24vw !important; max-width: 85px; max-height: 85px; padding-top: 0 !important; margin-right: 0.75rem !important; border-radius: 0.75rem !important; flex-shrink: 0; }
            .info-container { flex: 1; padding: 0 !important; min-width: 0; }
            .controls-container { width: 110px !important; flex-shrink: 0 !important; padding: 0 0 0 0.5rem !important; }
        }

        #filter-btn.filter-active-notify { background-color: #ef4444 !important; position: relative; }
        #filter-btn.filter-active-notify::after { content: ""; position: absolute; top: -2px; right: -2px; width: 10px; height: 10px; background-color: #fbbf24; border-radius: 50%; border: 2px solid white; }
    </style>
</head>
<body class="pb-40">
    <div id="update-announcement" class="fixed top-24 inset-x-4 z-[5000] transform -translate-y-32 opacity-0 transition-all duration-700 pointer-events-none">
        <div class="max-w-md mx-auto bg-white/80 backdrop-blur-xl border border-white/20 p-5 rounded-[2.5rem] shadow-[0_20px_50px_rgba(0,0,0,0.15)] flex items-center gap-4 pointer-events-auto">
            <div class="flex-shrink-0 w-12 h-12 bg-slate-900 rounded-2xl flex items-center justify-center shadow-lg text-blue-400">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4" />
                </svg>
            </div>
            <div class="flex-1">
                <h4 class="text-[14px] font-black uppercase tracking-wider text-slate-900">CatÃ¡logo Actualizado</h4>
                <p class="text-[11px] font-medium text-slate-500 leading-tight">Precios y stock sincronizados. Descubre nuestras novedades premium hoy.</p>
            </div>
            <button onclick="hideAnnouncement()" class="w-9 h-9 flex items-center justify-center bg-slate-100/50 hover:bg-white rounded-full text-slate-400 hover:text-slate-900 transition-all">âœ•</button>
        </div>
    </div>

    <header class="glass-header sticky top-0 z-40 p-4 lg:px-10 border-b border-slate-100">
        <div class="max-w-7xl mx-auto flex items-center justify-between gap-4">
            <h1 class="text-xl font-black text-slate-900 italic uppercase cursor-pointer" onclick="location.reload()">STARPHONE</h1>
            <input type="text" id="search" oninput="handleKeywordInput()" placeholder="Busca..." class="flex-1 min-w-0 px-4 py-2.5 bg-slate-100 rounded-2xl outline-none text-sm border-none">
            <button id="filter-btn" onclick="toggleMenu()" class="p-2.5 bg-slate-900 text-white rounded-xl shadow-lg active:scale-90 transition-all duration-300">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h10M4 18h16" />
                </svg>
            </button>
        </div>
    </header>

    <main class="max-w-7xl mx-auto p-4 lg:p-10">
        <div id="source-tabs" class="flex flex-nowrap gap-2 mb-4 no-scrollbar overflow-x-auto pb-2"></div>
        <div id="grid" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-6 product-grid"></div>
    </main>

    <div id="cart-bar" class="fixed bottom-6 inset-x-4 max-w-xl mx-auto hidden z-40">
        <div class="bg-slate-900 text-white p-4 rounded-[2.5rem] shadow-2xl flex justify-between items-center cursor-pointer" onclick="toggleCartModal()">
            <div class="pl-4">
                <span id="cart-info" class="text-2xl font-black text-blue-400">0</span>
                <span id="cart-total-bar" class="text-xl font-bold text-white ml-2">$0.00</span>
            </div>
            <div class="bg-blue-600 px-6 py-3 rounded-2xl text-sm font-black uppercase">Ver Pedido</div>
        </div>
    </div>

    <div id="cart-modal" class="fixed bottom-0 inset-x-0 bg-white z-[2000] rounded-t-[2.5rem] max-h-[85vh] overflow-hidden flex flex-col shadow-2xl">
        <div class="p-6 border-b border-slate-100 flex justify-between items-center">
            <h2 class="text-xl font-black text-slate-900 uppercase">Mi Pedido</h2>
            <button onclick="closeAllModals()" class="w-10 h-10 flex items-center justify-center bg-slate-100 rounded-full text-slate-400">âœ•</button>
        </div>
        <div id="cart-items-list" class="flex-1 overflow-y-auto p-4 space-y-3 bg-slate-50"></div>
        <div class="p-6 bg-white border-t border-slate-100">
            <div class="flex justify-between items-center mb-6 px-2">
                <span class="text-slate-500 font-bold uppercase text-[10px] tracking-widest">Total:</span>
                <span id="cart-total-modal" class="text-2xl font-black text-slate-900">$0.00</span>
            </div>
            <div class="flex gap-2 mb-4 bg-slate-100 p-1 rounded-full">
                <button id="btn-contact-0" onclick="selectContact(0)" class="flex-1 py-3 rounded-full text-xs font-bold transition-all">AXIN</button>
                <button id="btn-contact-1" onclick="selectContact(1)" class="flex-1 py-3 rounded-full text-xs font-bold transition-all">IVAN</button>
            </div>
            <button onclick="sendWhatsApp()" class="w-full bg-blue-600 text-white py-4 rounded-2xl font-black uppercase shadow-lg">Enviar WhatsApp</button>
        </div>
    </div>

    <div id="filter-menu" class="fixed inset-y-0 right-0 w-80 bg-white shadow-2xl z-[3000] transform translate-x-full p-6 transition-transform duration-300 flex flex-col">
        <div class="flex justify-between items-center mb-6 border-b pb-4">
            <h2 class="text-xl font-black text-slate-900 uppercase">Filtros</h2>
            <button onclick="closeAllModals()" class="text-slate-400 font-bold text-xl">âœ•</button>
        </div>
        <div id="filter-content" class="space-y-6 overflow-y-auto no-scrollbar flex-1"></div>
        <button onclick="closeAllModals()" class="mt-4 w-full bg-slate-900 text-white py-4 rounded-xl font-bold uppercase text-sm">Ver Resultados</button>
    </div>

    <div id="modal-overlay" class="fixed inset-0 bg-black/60 z-[1500] hidden backdrop-blur-sm flex items-center justify-center" onclick="closeAllModals()">
        <img id="lightbox-img" src="" class="hidden" onclick="event.stopPropagation(); this.classList.toggle('zoom-active')">
    </div>

    <script>
        let products = [], cart = {}, productNotes = {}, sources = [], currentSourceKey = null;
        let activeContactIndex = 0;
        const CONTACTS = [{name: "Axin", phone: "56926108498"}, {name: "Ivan", phone: "59168043587"}];
        let activeFilters = { keyword: "", MARCA: null, CATEGORIA: null, TIPO: null };
        let announcementTimer; 

        async function init() {
            try {
                const res = await fetch('sources.json');
                sources = await res.json();
                if (sources.length > 0) {
                    currentSourceKey = sources[0].key;
                    
                    // --- æ ¸å¿ƒæ”¹åŠ¨ï¼šç›´æŽ¥ç›‘æŽ§ products.json çš„æ—¥æœŸ ---
                    checkProductsFileDate();

                    renderSourceTabs(); 
                    const allCarts = JSON.parse(localStorage.getItem('starphone_carts_v2') || '{}');
                    const allNotes = JSON.parse(localStorage.getItem('starphone_notes_v2') || '{}');
                    cart = allCarts[currentSourceKey] || {};
                    productNotes = allNotes[currentSourceKey] || {};
                    await loadProducts();
                }
            } catch(e) { console.error(e); }
        }

        // æ–°å¢žï¼šè‡ªåŠ¨æ£€æŸ¥ products.json ä¿®æ”¹æ—¥æœŸ
        async function checkProductsFileDate() {
            try {
                // ç›´æŽ¥ fetch products.json èŽ·å– HEAD ä¿¡æ¯
                const response = await fetch('products.json', { method: 'HEAD' });
                const lastModified = response.headers.get('Last-Modified');

                if (lastModified) {
                    const savedDate = localStorage.getItem('starphone_products_modified');
                    // å¦‚æžœæœåŠ¡å™¨æ—¥æœŸå˜äº†ï¼Œä¸”æœ¬åœ°å·²æœ‰è®°å½•ï¼Œåˆ™å¼¹çª—
                    if (savedDate && savedDate !== lastModified) {
                        showAnnouncement(lastModified);
                    } else {
                        // é¦–æ¬¡è®¿é—®æˆ–æ—¥æœŸæœªå˜ï¼Œé™é»˜æ›´æ–°è®°å½•
                        localStorage.setItem('starphone_products_modified', lastModified);
                    }
                }
            } catch (e) { console.log("Date check skipped"); }
        }

        function showAnnouncement(newDate) {
            const el = document.getElementById('update-announcement');
            el.classList.remove('-translate-y-32', 'opacity-0', 'pointer-events-none');
            el.classList.add('translate-y-0', 'opacity-100');
            // 5ç§’åŽè‡ªåŠ¨å…³é—­
            announcementTimer = setTimeout(() => { hideAnnouncement(newDate); }, 5000);
        }

        function hideAnnouncement(dateToSave) {
            const el = document.getElementById('update-announcement');
            el.classList.add('-translate-y-32', 'opacity-0', 'pointer-events-none');
            el.classList.remove('translate-y-0', 'opacity-100');
            clearTimeout(announcementTimer);
            if (dateToSave) localStorage.setItem('starphone_products_modified', dateToSave);
        }

        async function loadProducts() {
            try {
                const src = sources.find(s => s.key === currentSourceKey);
                const res = await fetch(src.file);
                const raw = await res.json();
                products = raw.map((p, i) => ({ ...p, id: i }));
                resetFilters(false); renderFilters(); render(); selectContact(0);
            } catch(e) { console.error("Error:", e); }
        }

        function renderSourceTabs() {
            const container = document.getElementById('source-tabs');
            container.innerHTML = sources.map(s => {
                const isActive = s.key === currentSourceKey;
                return `<button onclick="setSource('${s.key}')" class="whitespace-nowrap px-6 py-2.5 rounded-2xl text-[11px] font-bold border-2 transition-all duration-200 ${isActive ? 'bg-slate-900 text-white border-slate-900 shadow-md' : 'bg-white text-slate-400 border-slate-100 hover:border-slate-300'}">${s.label}</button>`;
            }).join('');
        }

        function setSource(key) { 
            if (currentSourceKey === key) return;
            saveToLocal();
            currentSourceKey = key; 
            window.scrollTo(0, 0);
            document.documentElement.scrollLeft = 0;
            const allCarts = JSON.parse(localStorage.getItem('starphone_carts_v2') || '{}');
            const allNotes = JSON.parse(localStorage.getItem('starphone_notes_v2') || '{}');
            cart = allCarts[key] || {};
            productNotes = allNotes[key] || {};
            renderSourceTabs(); 
            closeAllModals(); 
            loadProducts(); 
        }

        function render() {
            const { keyword, MARCA, CATEGORIA, TIPO } = activeFilters;
            const filtered = products.filter(p => {
                const matchKeyword = !keyword || (p.PRODUCTO + (p.MARCA||"") + (p.CATEGORIA||"") + (p.TIPO||"")).toUpperCase().includes(keyword.toUpperCase());
                return matchKeyword && (!MARCA || p.MARCA === MARCA) && (!CATEGORIA || p.CATEGORIA === CATEGORIA) && (!TIPO || p.TIPO === TIPO);
            });
            const grid = document.getElementById('grid');
            if (filtered.length === 0) {
                grid.innerHTML = `<div class="col-span-full py-20 text-center"><h3 class="text-lg font-black text-slate-900 uppercase">Sin resultados</h3><button onclick="resetFilters()" class="mt-6 px-8 py-3 bg-slate-900 text-white rounded-2xl font-bold text-xs uppercase shadow-lg">Limpiar filtros</button></div>`;
                updateCartBar();
                return;
            }
            grid.innerHTML = filtered.map(p => {
                const q = cart[p.id] || 0;
                const imgUrl = p.Imagen_Path ? encodeURI(p.Imagen_Path.replace(/\\/g, '/')) : '';
                return `
                <div id="card-${p.id}" class="product-card shadow-sm">
                    <div class="image-container" onclick="openLightbox('${imgUrl}')"><img src="${imgUrl}" loading="lazy"></div>
                    <div class="info-container p-4">
                        <p class="text-[10px] font-bold text-indigo-500 uppercase tracking-wider">${p.MARCA || ''}</p>
                        <div class="detail-tooltip">
                            <h3 class="product-title" onmouseenter="toggleDetail(${p.id}, true)">${p.PRODUCTO}</h3>
                            <div id="detail-${p.id}" class="detail-content no-scrollbar">
                                <div class="flex justify-between items-center mb-3 border-b border-white/10 pb-1">
                                    <span class="text-blue-400 font-black uppercase">Detalles</span>
                                    <button onclick="event.stopPropagation(); closeAllModals()" class="text-white bg-white/10 w-6 h-6 rounded-full text-[10px]">âœ•</button>
                                </div>
                                ${p.DESC_FULL || 'Sin descripciÃ³n.'}
                            </div>
                        </div>
                        <div class="mt-2">
                            <span class="text-lg font-black text-slate-900">$${p['Precio ( USD )']}</span>
                        </div>
                    </div>
                    <div class="controls-container p-4 pt-0">
                        <div class="flex items-center bg-slate-900 rounded-xl p-1">
                            <button onclick="updateQty(${p.id},-1)" class="w-9 h-9 text-white">-</button>
                            <input type="number" value="${q}" onchange="setQty(${p.id}, this.value)" class="w-full bg-transparent text-white text-center text-sm font-black border-none outline-none">
                            <button onclick="updateQty(${p.id},1)" class="w-9 h-9 bg-blue-500 text-white rounded-lg">+</button>
                        </div>
                    </div>
                </div>`;
            }).join('');
            updateCartBar();
        }

        function updateFilterIconStatus() {
            const btn = document.getElementById('filter-btn');
            const isFiltering = activeFilters.keyword !== "" || activeFilters.MARCA !== null || activeFilters.CATEGORIA !== null || activeFilters.TIPO !== null;
            if (isFiltering) btn.classList.add('filter-active-notify'); else btn.classList.remove('filter-active-notify');
        }

        function renderFilters() {
            const { keyword, MARCA, CATEGORIA, TIPO } = activeFilters;
            const marcas = [...new Set(products.map(p => p.MARCA).filter(Boolean))].sort(); 
            const categorias = [...new Set(products.map(p => p.CATEGORIA).filter(Boolean))].sort(); 
            const tipos = [...new Set(products.map(p => p.TIPO).filter(Boolean))].sort(); 
            const createBtn = (list, type) => list.map(item => {
                const isActive = activeFilters[type] === item;
                const hasResults = products.some(p => {
                    const mK = !keyword || (p.PRODUCTO + (p.MARCA||"") + (p.CATEGORIA||"") + (p.TIPO||"")).toUpperCase().includes(keyword.toUpperCase());
                    const mM = (type === 'MARCA') ? true : (!activeFilters.MARCA || p.MARCA === activeFilters.MARCA);
                    const mC = (type === 'CATEGORIA') ? true : (!activeFilters.CATEGORIA || p.CATEGORIA === activeFilters.CATEGORIA);
                    const mT = (type === 'TIPO') ? true : (!activeFilters.TIPO || p.TIPO === activeFilters.TIPO);
                    return mK && mM && mC && mT && p[type] === item;
                });
                let btnClass = isActive ? "bg-slate-800 text-white border-slate-800 shadow-inner" : (hasResults ? "bg-white text-slate-600 border-slate-100 hover:border-slate-300" : "bg-slate-50 text-slate-300 border-slate-50 opacity-50 cursor-not-allowed");
                return `<button onclick="${hasResults || isActive ? `setFilter('${type}', '${item}')` : ''}" class="w-full text-left px-5 py-3 rounded-xl text-[11px] font-bold border uppercase transition-all duration-200 ${btnClass}">${item}${isActive ? '<span class="float-right">âœ•</span>' : ''}</button>`;
            }).join(''); 
            let html = ""; 
            if(categorias.length > 0) html += `<div><div class="flex justify-between items-center mb-3"><h3 class="text-blue-500 font-black text-[10px] uppercase tracking-widest">1. CategorÃ­as</h3>${activeFilters.CATEGORIA ? `<button onclick="setFilter('CATEGORIA', null)" class="text-[9px] font-bold text-slate-400 uppercase">Limpiar</button>` : ''}</div><div class="grid grid-cols-1 gap-1">${createBtn(categorias, 'CATEGORIA')}</div></div>`;
            if(marcas.length > 0) html += `<div class="mt-6"><div class="flex justify-between items-center mb-3"><h3 class="text-indigo-500 font-black text-[10px] uppercase tracking-widest">2. Marcas</h3>${activeFilters.MARCA ? `<button onclick="setFilter('MARCA', null)" class="text-[9px] font-bold text-slate-400 uppercase">Limpiar</button>` : ''}</div><div class="grid grid-cols-1 gap-1">${createBtn(marcas, 'MARCA')}</div></div>`;
            if(tipos.length > 0) html += `<div class="mt-6"><div class="flex justify-between items-center mb-3"><h3 class="text-slate-400 font-black text-[10px] uppercase tracking-widest">3. Otros Tipos</h3>${activeFilters.TIPO ? `<button onclick="setFilter('TIPO', null)" class="text-[9px] font-bold text-slate-400 uppercase">Limpiar</button>` : ''}</div><div class="grid grid-cols-1 gap-1">${createBtn(tipos, 'TIPO')}</div></div>`;
            document.getElementById('filter-content').innerHTML = html; 
        }

        function updateQty(id, chg) { let n = (cart[id] || 0) + chg; if (n <= 0) { delete cart[id]; delete productNotes[id]; } else cart[id] = n; saveToLocal(); render(); if(document.getElementById('cart-modal').classList.contains('active')) refreshCartModal(); }
        function setQty(id, val) { let n = parseInt(val); if (isNaN(n) || n <= 0) { delete cart[id]; delete productNotes[id]; } else { cart[id] = n; } saveToLocal(); render(); if(document.getElementById('cart-modal').classList.contains('active')) refreshCartModal(); }
        function toggleCartModal() { const isActive = document.getElementById('cart-modal').classList.toggle('active'); document.getElementById('modal-overlay').classList.toggle('hidden', !isActive); if(isActive) refreshCartModal(); }
        function closeAllModals() { document.querySelectorAll('.detail-content').forEach(d => d.classList.remove('active')); document.getElementById('cart-modal').classList.remove('active'); document.getElementById('filter-menu').classList.add('translate-x-full'); document.getElementById('modal-overlay').classList.add('hidden'); document.getElementById('lightbox-img').classList.add('hidden'); document.body.style.overflow = ''; }
        function saveToLocal() { const allCarts = JSON.parse(localStorage.getItem('starphone_carts_v2') || '{}'); const allNotes = JSON.parse(localStorage.getItem('starphone_notes_v2') || '{}'); allCarts[currentSourceKey] = cart; allNotes[currentSourceKey] = productNotes; localStorage.setItem('starphone_carts_v2', JSON.stringify(allCarts)); localStorage.setItem('starphone_notes_v2', JSON.stringify(allNotes)); }
        function updateCartBar() { let totalItems = 0, totalPrice = 0; for (let id in cart) { const p = products.find(i => i.id == id); if (p) { totalItems += cart[id]; totalPrice += (parseFloat(p['Precio ( USD )']) || 0) * cart[id]; } } document.getElementById('cart-bar').classList.toggle('hidden', totalItems === 0); document.getElementById('cart-info').innerText = totalItems; document.getElementById('cart-total-bar').innerText = `$${totalPrice.toLocaleString('en-US',{minimumFractionDigits:2})}`; }
        function handleKeywordInput() { activeFilters.keyword = document.getElementById('search').value; render(); renderFilters(); updateFilterIconStatus(); }
        function setFilter(type, val) { if (activeFilters[type] === val) { activeFilters[type] = null; } else { activeFilters[type] = val; } renderFilters(); render(); updateFilterIconStatus(); }
        function resetFilters(shouldRender = true) { activeFilters = { keyword: "", MARCA: null, CATEGORIA: null, TIPO: null }; document.getElementById('search').value = ""; if(shouldRender) { renderFilters(); render(); } updateFilterIconStatus(); }
        function openLightbox(src) { if(!src) return; const img = document.getElementById('lightbox-img'); img.src = src; img.classList.remove('hidden', 'zoom-active'); document.getElementById('modal-overlay').classList.remove('hidden'); if(window.innerWidth <= 768) document.body.style.overflow = 'hidden'; }
        function toggleMenu() { const menu = document.getElementById('filter-menu'); menu.classList.toggle('translate-x-full'); document.getElementById('modal-overlay').classList.toggle('hidden', menu.classList.contains('translate-x-full')); }
        function selectContact(i) { activeContactIndex = i; [0,1].forEach(idx => document.getElementById(`btn-contact-${idx}`).className = idx === i ? "flex-1 py-3 rounded-full text-xs font-black bg-blue-600 text-white shadow-md" : "flex-1 py-3 rounded-full text-xs font-bold bg-transparent text-slate-400"); }
        function toggleDetail(id, isHover = false) { if(window.innerWidth <= 768) return; const el = document.getElementById(`detail-${id}`); const card = document.getElementById(`card-${id}`); if(isHover) { card.classList.add('top-z'); el.classList.add('active'); card.onmouseleave = () => { el.classList.remove('active'); card.classList.remove('top-z'); }; } }
        function refreshCartModal() { const list = document.getElementById('cart-items-list'); let html = ""; for (let id in cart) { const p = products.find(i => i.id == id); if(!p) continue; html += `<div class="bg-white p-4 rounded-2xl border border-slate-200"><div class="flex items-center gap-3 mb-2"><img src="${p.Imagen_Path ? encodeURI(p.Imagen_Path.replace(/\\/g, '/')) : ''}" class="w-14 h-14 rounded-lg object-contain bg-slate-50"><div class="flex-1 min-w-0"><h4 class="text-[11px] font-bold text-slate-800 truncate uppercase">${p.PRODUCTO}</h4><span class="text-blue-600 font-bold">$${p['Precio ( USD )']}</span></div><div class="flex items-center bg-slate-50 rounded-lg border"><button onclick="updateQty(${id},-1)" class="px-2 py-1 text-slate-400 font-bold">-</button><input type="number" value="${cart[id]}" onchange="setQty(${id}, this.value)" class="qty-input-manual"><button onclick="updateQty(${id},1)" class="px-2 py-1 text-blue-500 font-bold">+</button></div><button onclick="setQty(${id}, 0)" class="p-2 text-red-500">Ã—</button></div><input type="text" placeholder="Nota..." class="note-input" value="${productNotes[id]||''}" oninput="productNotes[${id}]=this.value; saveToLocal()"></div>`; } list.innerHTML = html || "<p class='text-center py-20 text-slate-400 font-bold uppercase'>Tu lista estÃ¡ vacÃ­a</p>"; updateCartTotalDisplay(); }
        function updateCartTotalDisplay() { let total = 0; for (let id in cart) { const p = products.find(i => i.id == id); if (p) total += (parseFloat(p['Precio ( USD )']) || 0) * cart[id]; } document.getElementById('cart-total-modal').innerText = `$${total.toLocaleString('en-US',{minimumFractionDigits:2})}`; }
        function sendWhatsApp() { const contact = CONTACTS[activeContactIndex]; let total = 0, m = `â­ *NUEVO PEDIDO STARPHONE*\n--------------------------\n`; for(let id in cart) { const p = products.find(i => i.id == id); if (p) { const sub = (parseFloat(p['Precio ( USD )']) || 0) * cart[id]; total += sub; m += `âœ… *${p.PRODUCTO}*${productNotes[id] ? `\n   Nota: ${productNotes[id]}` : ''}\n   Cant: ${cart[id]} | Sub: *$${sub.toFixed(2)}*\n\n`; } } m += `--------------------------\nðŸ’° *TOTAL PEDIDO: $${total.toFixed(2)}*`; window.open(`https://wa.me/${contact.phone}?text=${encodeURIComponent(m)}`); }

        init();
    </script>
</body>
</html>